services:
  gossip-app:
    image: ghcr.io/${GITHUB_REPOSITORY_OWNER}/gossipapp:latest
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8888/health"]
      timeout: 3s
      retries: 5
    restart: unless-stopped
    network_mode: host
    environment:
      IS_SERVER: ${IS_SERVER}
      IS_CLIENT: ${IS_CLIENT}
      COORDINATOR_IP: ${COORDINATOR_IP}
      COORDINATOR_PORT: ${COORDINATOR_PORT}
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
    volumes:
      - ./logs:/app/logs

#
# GossipApp Single Container Setup:
# - Each VPS runs one container with different environment variables
# - VPS 1: IS_SERVER=true, IS_CLIENT=false (Coordinator)
# - VPS 2: IS_SERVER=false, IS_CLIENT=true (Client 1)
# - VPS 3: IS_SERVER=false, IS_CLIENT=true (Client 2)
# - Uses host networking mode for simplicity
# - Healthcheck only works for server (coordinator)
# - Logs are persisted to host filesystem
# - Environment variables control the application behavior:
#   - IS_SERVER/IS_CLIENT: Determines application mode
#   - COORDINATOR_IP/PORT: Network configuration (only needed for clients)
#   - TELEGRAM_BOT_TOKEN/CHAT_ID: Telegram integration (only needed for server)
